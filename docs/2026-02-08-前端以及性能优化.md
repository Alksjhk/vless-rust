# æµé‡ç»Ÿè®¡å›¾é‡æ„

**æ—¥æœŸ**: 2026-02-08  
**ç±»å‹**: é‡æ„ (refactor)

## æ¦‚è¿°

é‡æ–°æ„å»ºå‰ç«¯æµé‡ç»Ÿè®¡å›¾éƒ¨åˆ†ï¼Œä¼˜åŒ–ç»„ä»¶ç»“æ„ã€æå‡æ€§èƒ½å’Œæ”¹è¿›ç”¨æˆ·ä½“éªŒã€‚

## ä¸»è¦å˜æ›´

### 1. ç»„ä»¶æ•´åˆ

**åˆ é™¤**:
- `frontend/src/components/TrafficChart.jsx` - æ—§çš„æµé‡å›¾è¡¨ç»„ä»¶

**ä¼˜åŒ–**:
- `frontend/src/components/charts/SpeedChart.jsx` - ç»Ÿä¸€çš„é€Ÿåº¦è¶‹åŠ¿å›¾ç»„ä»¶
- `frontend/src/components/charts/TrafficChartSection.jsx` - å›¾è¡¨å®¹å™¨ç»„ä»¶

### 2. åŠŸèƒ½æ”¹è¿›

#### SpeedChart ç»„ä»¶
- âœ… æ”¯æŒé¢ç§¯å›¾å’ŒæŠ˜çº¿å›¾åˆ‡æ¢ï¼ˆé€šè¿‡ `showArea` å±æ€§ï¼‰
- âœ… åŠ¨æ€ Y è½´èŒƒå›´è®¡ç®—ï¼Œè‡ªåŠ¨é€‚åº”æ•°æ®è§„æ¨¡
- âœ… ä¼˜åŒ–çš„ X è½´åˆ»åº¦æ˜¾ç¤ºï¼ˆé¦–ã€ä¸­ã€å°¾ä¸‰ä¸ªæ—¶é—´ç‚¹ï¼‰
- âœ… æ”¹è¿›çš„ Tooltip äº¤äº’ä½“éªŒ
- âœ… ä½¿ç”¨ CSS å˜é‡é€‚é…ä¸»é¢˜ï¼ˆäº®è‰²/æš—è‰²æ¨¡å¼ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ `memo` å’Œ `useMemo` å‡å°‘é‡æ¸²æŸ“

#### TrafficChartSection ç»„ä»¶
- âœ… æ–°å¢è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆWebSocket/API è½®è¯¢/è¿æ¥ä¸­ï¼‰
- âœ… æ˜¾ç¤ºå†å²æ•°æ®æ—¶é•¿
- âœ… ä½¿ç”¨ Badge ç»„ä»¶ç¾åŒ–çŠ¶æ€æ˜¾ç¤º
- âœ… åŠ¨ç”»æ•ˆæœï¼šWebSocket è¿æ¥æ—¶çš„è„‰å†²åŠ¨ç”»

### 3. å·¥å…·å‡½æ•°ä¼˜åŒ–

**chartHelpers.js** æ–°å¢åŠŸèƒ½:
- `calculateYAxisMax()` - æ™ºèƒ½è®¡ç®— Y è½´æœ€å¤§å€¼
- `generateXAxisTicks()` - ç”Ÿæˆåˆé€‚çš„ X è½´åˆ»åº¦
- `chartTheme` - ç»Ÿä¸€çš„å›¾è¡¨ä¸»é¢˜é…ç½®
- æ”¹è¿›çš„ `formatSpeed()` - æ›´ç²¾ç¡®çš„é€Ÿåº¦æ ¼å¼åŒ–

### 4. è§†è§‰æ”¹è¿›

- ğŸ¨ ä½¿ç”¨æ¸å˜å¡«å……å¢å¼ºè§†è§‰æ•ˆæœ
- ğŸ¨ ç½‘æ ¼çº¿ä½¿ç”¨è™šçº¿æ ·å¼ï¼Œé™ä½è§†è§‰å¹²æ‰°
- ğŸ¨ Tooltip æ ·å¼é€‚é…ä¸»é¢˜ç³»ç»Ÿ
- ğŸ¨ å›¾ä¾‹ä½¿ç”¨æ–¹å½¢ç¬¦å·ï¼Œæ›´æ¸…æ™°
- ğŸ¨ è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨å¸¦åŠ¨ç”»æ•ˆæœ

### 5. å“åº”å¼ä¿®å¤

- âœ… ä¿®å¤æµé‡å›¾å°ºå¯¸é—®é¢˜
- âœ… æ·»åŠ å®¹å™¨å®½åº¦ç›‘å¬ï¼ˆä½¿ç”¨ `ResizeObserver`ï¼‰
- âœ… å›¾è¡¨å®½åº¦è‡ªåŠ¨é€‚åº”å®¹å™¨
- âœ… çª—å£å¤§å°å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è®¡ç®—å®½åº¦

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®æµ
```
monitorStore (speedHistory)
    â†“
TrafficChartSection (å®¹å™¨ + çŠ¶æ€æ˜¾ç¤º)
    â†“
SpeedChart (å›¾è¡¨æ¸²æŸ“)
```

### æ€§èƒ½ä¼˜åŒ–
1. **memo åŒ…è£¹ç»„ä»¶**ï¼šé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
2. **useMemo ç¼“å­˜è®¡ç®—**ï¼š
   - æ•°æ®æ ¼å¼è½¬æ¢
   - Y è½´æœ€å¤§å€¼è®¡ç®—
   - X è½´åˆ»åº¦ç”Ÿæˆ
3. **ç¦ç”¨åŠ¨ç”»**ï¼šVictory å›¾è¡¨åŠ¨ç”»åœ¨å®æ—¶æ•°æ®åœºæ™¯ä¸‹ä¼šå½±å“æ€§èƒ½

### ä¸»é¢˜é€‚é…
ä½¿ç”¨ CSS å˜é‡å®ç°ä¸»é¢˜åˆ‡æ¢ï¼š
```javascript
fill: 'hsl(var(--foreground))'
stroke: 'hsl(var(--border))'
```

## æ„å»ºç»“æœ

```
TrafficChartSection-B_F8or90.js    5.04 kB â”‚ gzip: 2.18 kB
chart-vendor-DecMr12B.js         293.91 kB â”‚ gzip: 93.94 kB
```

- å›¾è¡¨ç»„ä»¶ä½“ç§¯ä¼˜åŒ–
- ä»£ç åˆ†å‰²è‰¯å¥½
- Gzip å‹ç¼©ç‡é«˜

## å‘åå…¼å®¹æ€§

âœ… å®Œå…¨å…¼å®¹ç°æœ‰ API
- æ•°æ®æ ¼å¼ä¸å˜
- Store æ¥å£ä¸å˜
- ç»„ä»¶ props å‘åå…¼å®¹

## æµ‹è¯•

- âœ… ç¼–è¯‘æ£€æŸ¥é€šè¿‡
- âœ… æ„å»ºæˆåŠŸ
- âœ… æ—  TypeScript/ESLint é”™è¯¯

## åç»­ä¼˜åŒ–å»ºè®®

1. **æ•°æ®é‡‡æ ·**ï¼šå½“å†å²æ•°æ®ç‚¹è¿‡å¤šæ—¶ï¼ˆ>200ï¼‰ï¼Œå¯ä»¥è€ƒè™‘é‡‡æ ·æ˜¾ç¤º
2. **ç¼©æ”¾åŠŸèƒ½**ï¼šæ·»åŠ å›¾è¡¨ç¼©æ”¾å’Œå¹³ç§»åŠŸèƒ½
3. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒå¯¼å‡ºå›¾è¡¨ä¸ºå›¾ç‰‡
4. **å¤šæ—¶é—´èŒƒå›´**ï¼šæ”¯æŒåˆ‡æ¢ 1 åˆ†é’Ÿ/5 åˆ†é’Ÿ/30 åˆ†é’Ÿè§†å›¾

## ç›¸å…³æ–‡ä»¶

- `frontend/src/components/charts/SpeedChart.jsx`
- `frontend/src/components/charts/TrafficChartSection.jsx`
- `frontend/src/utils/chartHelpers.js`
- `frontend/src/store/monitorStore.js`

---

## 2026-02-08 æ›´æ–°ï¼šå›ºå®šæ—¶é—´çª—å£æ˜¾ç¤º

### é—®é¢˜æè¿°

åˆšå¯åŠ¨æ—¶ï¼Œæµé‡è¶‹åŠ¿å›¾çš„æ—¶é—´è½´ä¼šé€æ¸ä»å³å¾€å·¦æ¨å‡ºï¼Œå¯¼è‡´æ—¶é—´è½´ä¸å¤Ÿå›ºå®šï¼Œç”¨æˆ·ä½“éªŒä¸ä½³ã€‚

### è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹å›¾è¡¨æ•°æ®è½¬æ¢é€»è¾‘ï¼Œå®ç°å›ºå®šçš„2åˆ†é’Ÿï¼ˆ120ç§’ï¼‰æ—¶é—´çª—å£ï¼š

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/components/charts/SpeedChart.jsx`

#### æ ¸å¿ƒå˜æ›´

1. **å›ºå®šæ§½ä½è®¾è®¡**ï¼š
   - ä»åŠ¨æ€æ•°æ®ç‚¹æ”¹ä¸ºå›ºå®š120ä¸ªæ§½ä½ï¼ˆ120ç§’ï¼‰
   - æ¯ä¸ªæ§½ä½ä»£è¡¨1ç§’ï¼Œä»"å½“å‰æ—¶é—´-119ç§’"åˆ°"å½“å‰æ—¶é—´"
   - ç¼ºå¤±æ•°æ®ç‚¹çš„é€Ÿåº¦è‡ªåŠ¨å¡«å……ä¸º0

2. **æ•°æ®æ˜ å°„é€»è¾‘**ï¼š
   - ä»¥æœ€æ–°æ•°æ®ç‚¹çš„æ—¶é—´æˆ³ä½œä¸ºåŸºå‡†ï¼ˆæˆ–ä½¿ç”¨å½“å‰æ—¶é—´ï¼‰
   - æ„å»º120ä¸ªæ—¶é—´æ§½ä½ï¼ŒæŸ¥æ‰¾æ¯ä¸ªæ§½ä½å¯¹åº”çš„å†å²æ•°æ®
   - æœªåŒ¹é…åˆ°æ•°æ®çš„æ§½ä½æ˜¾ç¤º0é€Ÿåº¦

3. **Xè½´åˆ»åº¦å›ºå®š**ï¼š
   - åœ¨å›ºå®š120ä¸ªæ§½ä½ä¸Šå‡åŒ€åˆ†å¸ƒ10ä¸ªåˆ»åº¦
   - æ—¶é—´è½´å§‹ç»ˆä¿æŒç¨³å®šï¼Œä¸éšæ•°æ®é‡å˜åŒ–

### æŠ€æœ¯å®ç°

```javascript
// å›ºå®š120ä¸ªæ§½ä½ï¼ˆ120ç§’ï¼‰
const FIXED_SLOTS = 120
const latestTimestamp = parseInt(speedHistory[speedHistory.length - 1].timestamp)

// æ„å»ºæ—¶é—´çª—å£
for (let i = 0; i < FIXED_SLOTS; i++) {
  const slotTimestamp = latestTimestamp - (FIXED_SLOTS - 1 - i)
  const matchedData = speedHistory.find(item => parseInt(item.timestamp) === slotTimestamp)

  fixedSlots.push({
    x: i,
    time: formatTime(slotTimestamp),
    upload: parseSpeedString(matchedData?.upload_speed || '0 B/s'),
    download: parseSpeedString(matchedData?.download_speed || '0 B/s'),
    timestamp: slotTimestamp
  })
}
```

### æ•ˆæœ

- âœ… åˆšå¯åŠ¨æ—¶å°±æ˜¾ç¤ºå®Œæ•´çš„2åˆ†é’Ÿæ—¶é—´çª—å£
- âœ… ç¼ºå¤±æ•°æ®çš„æ—¶é—´æ®µé€Ÿåº¦ä¸º0ï¼Œé¢„ç•™ç©ºé—´
- âœ… æ—¶é—´è½´å›ºå®šï¼Œä¸ä¼šé€æ¸æ¨å‡º
- âœ… éšç€æ•°æ®ç´¯ç§¯ï¼Œä»å³å‘å·¦å¡«å……å›¾è¡¨
- âœ… è§†è§‰ä½“éªŒæ›´åŠ ç¨³å®šå’Œç›´è§‚

---

## 2026-02-08 æ›´æ–°ï¼šè¿æ¥é™åˆ¶ä¸æ€§èƒ½ä¼˜åŒ–

### æ¦‚è¿°

å®æ–½åç«¯ VLESS è¿æ¥æ•°é™åˆ¶ï¼ˆ1000ä¸ªï¼‰å’Œå‰ç«¯ WebSocket å¤šæ ‡ç­¾é¡µåè°ƒï¼ˆé™åˆ¶ä¸º5ä¸ªè¿æ¥ï¼‰ï¼Œå¹¶è¿›è¡Œå…¨é¢çš„æ€§èƒ½ä¼˜åŒ–ã€‚

### åç«¯å˜æ›´

#### 1. è¿æ¥é™åˆ¶å®ç°

**ä¿®æ”¹æ–‡ä»¶**: `src/config.rs`, `src/stats.rs`, `src/server.rs`

**é…ç½®ä¿®æ”¹**:
- WebSocket æœ€å¤§è¿æ¥æ•°ï¼š300 â†’ **5**
- VLESS æœ€å¤§è¿æ¥æ•°ï¼š300 â†’ **1000**

**æ–°å¢åŠŸèƒ½**:
- VLESS è¿æ¥æ•°æ£€æŸ¥ï¼šåœ¨ UUID éªŒè¯åã€ConnectionGuard åˆ›å»ºå‰æ£€æŸ¥å½“å‰è¿æ¥æ•°
- æ‹’ç»è¿æ¥è®¡æ•°å™¨ï¼šä½¿ç”¨ `AtomicU64` åŸå­æ“ä½œè®°å½•æ‹’ç»çš„è¿æ¥æ•°
- è¿æ¥æ•°è·å–æ–¹æ³•ï¼š`Stats::get_active_connections()`

**ä»£ç ç¤ºä¾‹**:
```rust
// è¿æ¥æ•°æ£€æŸ¥
let current_connections = {
    let stats_guard = stats.lock().await;
    stats_guard.get_active_connections()
};

if current_connections >= monitoring_config.vless_max_connections {
    warn!("VLESS connection limit reached: {}/{} from {}",
          current_connections, monitoring_config.vless_max_connections, client_addr);
    stats.lock().await.increment_rejected_connections();
    return Err(anyhow!("Server connection limit reached"));
}
```

#### 2. ç›‘æ§æŒ‡æ ‡æ‰©å±•

**æ–°å¢å­—æ®µ**:
- `MonitorData.rejected_connections` - æ‹’ç»çš„è¿æ¥æ€»æ•°
- `Stats.rejected_connections` - ä½¿ç”¨ `Arc<AtomicU64>` å®ç°ï¼Œå‡å°‘é”ç«äº‰

**API è¿”å›ç¤ºä¾‹**:
```json
{
  "active_connections": 150,
  "max_connections": 1000,
  "rejected_connections": 25
}
```

### å‰ç«¯å˜æ›´

#### 1. WebSocket å¤šæ ‡ç­¾é¡µåè°ƒ

**æ–°å¢æ–‡ä»¶**: `frontend/src/api/ws-coordinator.js`

**æ ¸å¿ƒæœºåˆ¶**:
- ä½¿ç”¨ **BroadcastChannel API** å®ç°å¤šæ ‡ç­¾é¡µåè°ƒ
- ä¸»ä»é€‰ä¸¾ï¼šé€‰ä¸¾ä¸€ä¸ª"ä¸»è¿æ¥"æ ‡ç­¾é¡µè´Ÿè´£åˆ›å»º WebSocket è¿æ¥
- æ•°æ®å¹¿æ’­ï¼šä¸»è¿æ¥é€šè¿‡ BroadcastChannel å¹¿æ’­æ•°æ®ç»™ä»æ ‡ç­¾é¡µ
- å¿ƒè·³æ£€æµ‹ï¼šä¸»è¿æ¥æ¯5ç§’å‘é€å¿ƒè·³ï¼Œä»æ ‡ç­¾é¡µ10ç§’æœªæ”¶åˆ°åˆ™é‡æ–°é€‰ä¸¾

**æ¶æ„å›¾**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BroadcastChannel 'ws-coordinator'     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Tab 1   â”‚      â”‚ Tab 2   â”‚      â”‚ Tab 3   â”‚
   â”‚ Master  â”‚      â”‚ Followerâ”‚      â”‚ Followerâ”‚
   â”‚ (WSè¿æ¥) â”‚      â”‚ (æ— è¿æ¥) â”‚      â”‚ (æ— è¿æ¥) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ç»†èŠ‚**:
- æ¶ˆæ¯ç±»å‹ï¼š`ELECT_MASTER`, `IAM_MASTER`, `MASTER_HEARTBEAT`, `DATA_BROADCAST`
- é€‰ä¸¾è¶…æ—¶ï¼š500ms
- å¿ƒè·³é—´éš”ï¼š5ç§’
- å¿ƒè·³è¶…æ—¶ï¼š10ç§’
- é™çº§ç­–ç•¥ï¼šä¸æ”¯æŒ BroadcastChannel çš„æµè§ˆå™¨é™çº§åˆ°ç‹¬ç«‹è¿æ¥

#### 2. çŠ¶æ€ç®¡ç†é›†æˆ

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/store/monitorStore.js`

**ä¸»è¦å˜æ›´**:
- å¼•å…¥ `WebSocketCoordinator` æ›¿ä»£ç›´æ¥çš„ `WebSocketClient`
- `connect()` æ–¹æ³•æ”¹ä¸ºè°ƒç”¨åè°ƒå™¨çš„é€‰ä¸¾æœºåˆ¶
- æ–°å¢ `coordinator` çŠ¶æ€å­—æ®µ
- å…¼å®¹æ—§çš„ `wsClient` å­—æ®µ

#### 3. ç»„ä»¶æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–æ–‡ä»¶**:
- `frontend/src/components/metrics/ConnectionsMetric.jsx`
- `frontend/src/components/metrics/SpeedMetric.jsx`
- `frontend/src/components/metrics/MemoryMetric.jsx`
- `frontend/src/components/metrics/TrafficMetric.jsx`
- `frontend/src/components/metrics/UptimeMetric.jsx`
- `frontend/src/components/ResourceCard.jsx`
- `frontend/src/components/SystemInfo.jsx`

**ä¼˜åŒ–æªæ–½**:
1. **React.memo**ï¼šæ‰€æœ‰ç»„ä»¶ä½¿ç”¨ `memo` åŒ…è£¹ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
2. **useMemo**ï¼šç¼“å­˜è®¡ç®—å¯†é›†å‹æ“ä½œï¼ˆç™¾åˆ†æ¯”ã€çŠ¶æ€åˆ¤æ–­ã€é¢œè‰²ç±»ï¼‰
3. **é™æ€å¯¹è±¡å¤–ç§»**ï¼š`colorClasses` å¯¹è±¡ç§»åˆ°ç»„ä»¶å¤–éƒ¨ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“é‡æ–°åˆ›å»º

**ä»£ç ç¤ºä¾‹**:
```javascript
// ä¼˜åŒ–å‰
export default function ConnectionsMetric() {
  const connectionPercent = maxConnections > 0
    ? Math.round((activeConnections / maxConnections) * 100)
    : 0
  // ...
}

// ä¼˜åŒ–å
export default function ConnectionsMetric() {
  const connectionPercent = useMemo(() =>
    maxConnections > 0
      ? Math.round((activeConnections / maxConnections) * 100)
      : 0,
    [activeConnections, maxConnections]
  )
  // ...
}
```

#### 4. å·¥å…·å‡½æ•°åº“

**æ–°å¢æ–‡ä»¶**: `frontend/src/utils/debounce.js`

**åŠŸèƒ½**:
- `debounce(func, delay)` - é˜²æŠ–å‡½æ•°
- `throttle(func, delay)` - èŠ‚æµå‡½æ•°

**ç”¨é€”**:
- é«˜é¢‘äº‹ä»¶å¤„ç†ï¼ˆå¦‚çª—å£ resizeã€scrollï¼‰
- çŠ¶æ€æ›´æ–°ä¼˜åŒ–ï¼ˆå¯åç»­åº”ç”¨åˆ° monitorStoreï¼‰

### æŠ€æœ¯äº®ç‚¹

#### åç«¯
1. **åŸå­æ“ä½œ**ï¼šä½¿ç”¨ `AtomicU64` æ›¿ä»£ Mutex ä¿æŠ¤çš„è®¡æ•°å™¨ï¼Œå‡å°‘é”ç«äº‰
2. **çº¿ç¨‹å®‰å…¨**ï¼šè¿æ¥æ•°æ£€æŸ¥ä½¿ç”¨ `try_lock()` é¿å…é˜»å¡
3. **RAII æ¨¡å¼**ï¼šConnectionGuard ç¡®ä¿è¿æ¥æ•°å‡†ç¡®è¿½è¸ª
4. **ç›‘æ§å¢å¼º**ï¼šæ–°å¢æ‹’ç»è¿æ¥æŒ‡æ ‡ï¼Œä¾¿äºå‘Šè­¦

#### å‰ç«¯
1. **é›¶ä¾èµ–**ï¼šBroadcastChannel æ˜¯æµè§ˆå™¨åŸç”Ÿ APIï¼Œæ— éœ€é¢å¤–åº“
2. **å…¼å®¹æ€§å¥½**ï¼šæ”¯æŒ Chrome 54+, Firefox 38+, Safari 10.1+
3. **æ™ºèƒ½é™çº§**ï¼šä¸æ”¯æŒæ—¶è‡ªåŠ¨é™çº§åˆ°ç‹¬ç«‹è¿æ¥
4. **æ€§èƒ½æå‡**ï¼šReact æ€§èƒ½ä¼˜åŒ–å‡å°‘æ¸²æŸ“å¼€é”€

### æ•ˆæœé¢„æœŸ

- **WebSocket è¿æ¥æ•°**ï¼šä» N ä¸ª/ç”¨æˆ·é™ä½åˆ° 1 ä¸ª/ç”¨æˆ·ï¼ˆå‡å°‘ 80%+ï¼‰
- **VLESS è¿æ¥**ï¼šå®é™…é™åˆ¶ 1000 ä¸ªï¼Œé˜²æ­¢èµ„æºè€—å°½
- **å‰ç«¯æ€§èƒ½**ï¼šå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œæå‡ UI æµç•…åº¦
- **ç›‘æ§èƒ½åŠ›**ï¼šæ–°å¢ rejected_connections æŒ‡æ ‡ï¼Œä¾¿äºå‘Šè­¦

### å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å…¼å®¹**
- é…ç½®æ–‡ä»¶è‡ªåŠ¨ä½¿ç”¨æ–°é»˜è®¤å€¼
- æ—§ config.json æ— éœ€æ‰‹åŠ¨ä¿®æ”¹
- å‰ç«¯é™çº§æœºåˆ¶ç¡®ä¿åŠŸèƒ½å¯ç”¨

### æµ‹è¯•å»ºè®®

#### åç«¯æµ‹è¯•
```bash
# 1. ç¼–è¯‘é¡¹ç›®
cargo build --release

# 2. è¿è¡ŒæœåŠ¡å™¨
./target/release/vless-rust

# 3. ä½¿ç”¨æµ‹è¯•è„šæœ¬åˆ›å»º 1001 ä¸ªè¿æ¥
# éªŒè¯ç¬¬ 1001 ä¸ªè¢«æ‹’ç»

# 4. æ£€æŸ¥ç›‘æ§ API
curl http://localhost:8443/api/stats | jq '.rejected_connections'
```

#### å‰ç«¯æµ‹è¯•
1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ 10 ä¸ªæ ‡ç­¾é¡µ
2. æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œåº”è¯¥åªæœ‰ 1 ä¸ª WS è¿æ¥
3. å…³é—­ä¸»æ ‡ç­¾é¡µï¼ŒéªŒè¯ 10 ç§’å†…æœ‰æ–°æ ‡ç­¾é¡µæ¥ç®¡
4. æ‰€æœ‰æ ‡ç­¾é¡µæ•°æ®åº”ä¿æŒåŒæ­¥

### ç›¸å…³æ–‡ä»¶

#### åç«¯
- `src/config.rs` - é»˜è®¤é…ç½®ä¿®æ”¹
- `src/stats.rs` - æ‹’ç»è¿æ¥è®¡æ•°å™¨
- `src/server.rs` - VLESS è¿æ¥æ£€æŸ¥é€»è¾‘

#### å‰ç«¯
- `frontend/src/api/ws-coordinator.js` - WebSocket åè°ƒå™¨ï¼ˆæ–°å¢ï¼‰
- `frontend/src/utils/debounce.js` - é˜²æŠ–å·¥å…·ï¼ˆæ–°å¢ï¼‰
- `frontend/src/store/monitorStore.js` - åè°ƒå™¨é›†æˆ
- `frontend/src/components/metrics/*.jsx` - æ€§èƒ½ä¼˜åŒ–
- `frontend/src/components/ResourceCard.jsx` - æ€§èƒ½ä¼˜åŒ–
- `frontend/src/components/SystemInfo.jsx` - æ€§èƒ½ä¼˜åŒ–

#### æ–‡æ¡£
- `docs/technology.md` - æ–‡ä»¶æ˜ å°„å…³ç³»æ›´æ–°

---

## 2026-02-08 æ›´æ–°ï¼šå›¾è¡¨å¸ƒå±€å’ŒYè½´åˆ»åº¦ä¼˜åŒ–

### æ¦‚è¿°

ä¼˜åŒ–æµé‡è¶‹åŠ¿å›¾çš„å¸ƒå±€æ¯”ä¾‹ã€å›¾è¡¨é«˜åº¦å’Œ Y è½´åˆ»åº¦æ˜¾ç¤ºé€»è¾‘,æä¾›æ›´å¥½çš„è§†è§‰æ•ˆæœå’Œæ•°æ®å¯è¯»æ€§ã€‚

### ä¸»è¦å˜æ›´

#### 1. å¸ƒå±€ä¼˜åŒ–

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/App.jsx`

**å˜æ›´å†…å®¹**:
- ç½‘æ ¼åˆ—æ•°: `lg:grid-cols-3` â†’ `lg:grid-cols-6`
- æµé‡å›¾è·¨åˆ—: `lg:col-span-2` â†’ `lg:col-span-5`
- ç³»ç»Ÿé¢æ¿è·¨åˆ—: `lg:col-span-1` (ä¿æŒä¸å˜)

**æ•ˆæœ**:
- æµé‡å›¾å æ®æ›´å®½çš„ç©ºé—´ (5/6 vs 2/3)
- ç³»ç»Ÿé¢æ¿å æ®æ›´çª„çš„ç©ºé—´ (1/6 vs 1/3)
- æ•´ä½“å¸ƒå±€æ›´åŠ çµæ´»,é€‚é…ä¸åŒå±å¹•å°ºå¯¸

#### 2. å›¾è¡¨å°ºå¯¸è°ƒæ•´

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/components/charts/TrafficChartSection.jsx`

**å˜æ›´å†…å®¹**:
- å›¾è¡¨é«˜åº¦: `height={500}` â†’ `height={300}`
- æ·»åŠ è´Ÿè¾¹è·: `className="pt-2 -ml-8"` (ç”¨äºè°ƒæ•´å›¾è¡¨å·¦å³ä½ç½®)

**æ•ˆæœ**:
- å›¾è¡¨æ›´ç´§å‡‘,å‡å°‘é¡µé¢å ç”¨ç©ºé—´
- æµé‡å›¾å’Œç³»ç»Ÿé¢æ¿é«˜åº¦æ›´åè°ƒ

#### 3. Yè½´åˆ»åº¦ä¼˜åŒ–

**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/components/charts/SpeedChart.jsx`

**æ–°å¢åŠŸèƒ½**:

1. **å›ºå®šåˆ»åº¦æ•°é‡**:
   ```javascript
   // è®¡ç®— Y è½´åˆ»åº¦å€¼ï¼ˆå›ºå®š5ä¸ªåˆ»åº¦ï¼‰
   const yAxisTicks = useMemo(() => {
     const ticks = []
     for (let i = 0; i <= 4; i++) {
       ticks.push((maxY / 4) * i)
     }
     return ticks
   }, [maxY])
   ```

2. **æ”¹è¿›çš„æœ€å¤§å€¼è®¡ç®—**:
   - æ·»åŠ  15% ç¼“å†²ç©ºé—´,é¿å…æ•°æ®ç´§è´´å›¾è¡¨é¡¶éƒ¨
   - æ ¹æ®æ•°å€¼èŒƒå›´åŠ¨æ€é€‰æ‹©å‘ä¸Šå–æ•´ç²¾åº¦
   - å°äº1MBæ—¶,å‘ä¸Šå–æ•´åˆ°0.1çš„å€æ•°
   - 1-10MBæ—¶,å‘ä¸Šå–æ•´åˆ°0.5çš„å€æ•°
   - å¤§äº10MBæ—¶,å‘ä¸Šå–æ•´åˆ°æ•´æ•°

3. **å›¾è¡¨æ ·å¼è°ƒæ•´**:
   - åˆå§‹å®½åº¦: `600` â†’ `1400` (æ›´æ¥è¿‘å®é™…å®¹å™¨å®½åº¦)
   - å·¦è¾¹è·: `55` â†’ `115` (ä¸ºYè½´æ ‡ç­¾é¢„ç•™æ›´å¤šç©ºé—´)
   - å³è¾¹è·: `30` â†’ `20` (å‡å°‘å³ä¾§ç©ºç™½)
   - é¡¶è¾¹è·: `20` â†’ `40` (ä¸ºå›¾ä¾‹é¢„ç•™ç©ºé—´)
   - åº•è¾¹è·: `50` â†’ `35` (ä¼˜åŒ–Xè½´æ ‡ç­¾æ˜¾ç¤º)
   - å­—ä½“å¤§å°: `11px` â†’ `12px` (æå‡å¯è¯»æ€§)
   - çº¿æ¡å®½åº¦: `2px` â†’ `3px` (å¢å¼ºè§†è§‰å¯¹æ¯”)

4. **å›¾ä¾‹ä½ç½®ä¼˜åŒ–**:
   - ä½ç½®: å›ºå®š `x=60` â†’ åŠ¨æ€ `x={chartWidth - 130}`
   - æ·»åŠ  `anchor="end"` å¯¹é½æ–¹å¼
   - å­—ä½“å¤§å°: `12px` â†’ `13px`

**æ•ˆæœ**:
- Yè½´åˆ»åº¦å›ºå®šä¸º5ä¸ª,æ˜¾ç¤ºæ›´ä¸€è‡´
- åˆ»åº¦å€¼åŠ¨æ€è®¡ç®—,é¿å…å¥‡æ€ªçš„å°æ•°
- å›¾è¡¨åœ¨ä¸åŒæ•°æ®è§„æ¨¡ä¸‹éƒ½æœ‰è‰¯å¥½çš„æ˜¾ç¤ºæ•ˆæœ
- å›¾ä¾‹å§‹ç»ˆä½äºå³ä¸Šè§’,ä¸é®æŒ¡æ•°æ®

### æŠ€æœ¯ç»†èŠ‚

#### Yè½´åˆ»åº¦è®¡ç®—æµç¨‹

```
1. è·å–æ•°æ®æœ€å¤§å€¼ (maxUpload, maxDownload)
   â†“
2. åˆ¤æ–­æ˜¯å¦å°äºé»˜è®¤å€¼ (0.195 MB/s)
   â†“ (æ˜¯)
   ä½¿ç”¨é»˜è®¤å€¼ 0.195 MB/s
   â†“ (å¦)
3. æ·»åŠ 15%ç¼“å†²: bufferedMax = max * 1.15
   â†“
4. æ ¹æ®ç¼“å†²å€¼å‘ä¸Šå–æ•´:
   - < 1MB â†’ å–æ•´åˆ°0.1çš„å€æ•°
   - 1-10MB â†’ å–æ•´åˆ°0.5çš„å€æ•°
   - > 10MB â†’ å–æ•´åˆ°æ•´æ•°
   â†“
5. ç”Ÿæˆ5ä¸ªå‡åŒ€åˆ†å¸ƒçš„åˆ»åº¦å€¼
```

#### å¸ƒå±€æ¯”ä¾‹å¯¹æ¯”

| å…ƒç´  | ä¿®æ”¹å‰ | ä¿®æ”¹å | å˜åŒ– |
|------|--------|--------|------|
| ç½‘æ ¼åˆ—æ•° | 3åˆ— | 6åˆ— | +100% |
| æµé‡å›¾å æ¯” | 2/3 (66.7%) | 5/6 (83.3%) | +25% |
| ç³»ç»Ÿé¢æ¿å æ¯” | 1/3 (33.3%) | 1/6 (16.7%) | -50% |
| å›¾è¡¨é«˜åº¦ | 500px | 300px | -40% |

### æ•ˆæœé¢„è§ˆ

**ä¿®æ”¹å‰**:
- æµé‡å›¾å æ®ä¸­ç­‰å®½åº¦
- Yè½´åˆ»åº¦æ•°é‡ä¸å›ºå®š
- å›¾è¡¨é«˜åº¦è¾ƒé«˜
- å›¾ä¾‹ä½ç½®å›ºå®šåœ¨å·¦ä¾§

**ä¿®æ”¹å**:
- æµé‡å›¾å æ®æ›´å®½ç©ºé—´
- Yè½´å›ºå®š5ä¸ªåˆ»åº¦,æ˜¾ç¤ºæ›´æ•´é½
- å›¾è¡¨æ›´ç´§å‡‘
- å›¾ä¾‹å§‹ç»ˆåœ¨å³ä¸Šè§’

### å·²çŸ¥é—®é¢˜

âš ï¸ **è´Ÿè¾¹è·ä½¿ç”¨**:
- ä½¿ç”¨ `-ml-8` æ˜¯ä¸€ç§ hack æ–¹å¼,å¯èƒ½å¯¼è‡´æŸäº›å±å¹•å°ºå¯¸ä¸‹å¸ƒå±€å¼‚å¸¸
- å»ºè®®: åç»­è€ƒè™‘è°ƒæ•´å›¾è¡¨å†…éƒ¨çš„ padding å€¼

âš ï¸ **å¤§å±å¹•å¸ƒå±€**:
- åœ¨è¶…å¤§å±å¹•(>1920px)ä¸Š,ç³»ç»Ÿé¢æ¿å¯èƒ½è¿‡äºç‹­çª„
- å»ºè®®: æ·»åŠ  `xl:breakpoint` è¿›ä¸€æ­¥ä¼˜åŒ–å¸ƒå±€æ¯”ä¾‹

âš ï¸ **åˆå§‹å®½åº¦å€¼**:
- `useState(1400)` å¯èƒ½å¯¼è‡´é¦–æ¬¡æ¸²æŸ“æ—¶å›¾è¡¨è¿‡å®½
- å»ºè®®: ä½¿ç”¨ `window.innerWidth` æˆ–æ›´åˆç†çš„é»˜è®¤å€¼

### å‘åå…¼å®¹æ€§

âœ… **å®Œå…¨å…¼å®¹**
- æ•°æ®æ ¼å¼ä¸å˜
- APIæ¥å£ä¸å˜
- ç»„ä»¶propså‘åå…¼å®¹
- åªæ˜¯è§†è§‰å’Œå¸ƒå±€å±‚é¢çš„ä¼˜åŒ–

### ç›¸å…³æ–‡ä»¶

- `frontend/src/App.jsx` - å¸ƒå±€ç½‘æ ¼è°ƒæ•´
- `frontend/src/components/charts/SpeedChart.jsx` - Yè½´åˆ»åº¦å’Œæ ·å¼ä¼˜åŒ–
- `frontend/src/components/charts/TrafficChartSection.jsx` - å›¾è¡¨é«˜åº¦å’Œè¾¹è·è°ƒæ•´
