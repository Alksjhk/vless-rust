# 2026-02-10 移除前端和监控功能，精简为纯VLESS服务器

## 概述
将项目从前端+监控+VLESS服务器的混合架构，精简为纯粹的VLESS协议服务器。

## 主要变更

### 移除的功能

**前端相关：**
- 移除 `frontend/` 整个前端项目目录（React + Vite 监控页面）
- 移除 `static/` 前端构建产物目录
- 移除 `rust-embed` 静态资源嵌入功能

**后端模块：**
- 移除 `src/stats.rs` - 流量统计模块
- 移除 `src/ws.rs` - WebSocket 实时推送模块
- 移除 `src/memory.rs` - 内存信息获取模块

**配置相关：**
- 移除 `MonitoringConfig` 配置结构体
- 移除 `ServerSettings.public_ip` 字段（外网IP检测）
- 移除 `PerformanceConfig.stats_batch_size` 字段（批量统计）

**工具函数：**
- 移除 `src/utils.rs` 中的 `get_public_ip()` 函数（外网IP检测）
- 保留 `generate_vless_url()` 函数（VLESS URL生成）

### 简化的模块

**src/http.rs**
- 保留：`is_http_request()` 函数（用于区分HTTP和VLESS请求）
- 移除：所有API端点处理、静态文件服务、WebSocket升级处理

**src/config.rs**
- 移除 `MonitoringConfig` 结构体
- 移除 `Config.monitoring` 和 `Config.monitor` 字段
- 移除 `ServerSettings.public_ip` 字段
- 简化 `PerformanceConfig`，移除 `stats_batch_size` 字段

**src/server.rs**
- 移除所有流量统计相关代码
- 移除连接数统计和限制
- 移除HTTP请求处理（保留检测）
- 移除WebSocket升级处理
- 移除 `ConnectionGuard` RAII guard
- 保留纯粹的VLESS协议处理和TCP/UDP代理转发

**src/main.rs**
- 移除统计模块初始化
- 移除WebSocket管理器初始化
- 移除外网IP检测功能
- 移除统计持久化任务
- 移除WebSocket广播任务
- 简化为配置加载 -> 服务器启动

**src/wizard.rs**
- 移除 `public_ip` 和 `monitoring` 字段配置
- 保留基础服务器和用户配置

### 依赖变更

**移除的依赖：**
- `tokio-tungstenite` - WebSocket支持
- `futures-util` - WebSocket辅助
- `rust-embed` - 静态资源嵌入
- `reqwest` - 外网IP检测
- `windows` crate的 `Win32_System_ProcessStatus` feature（内存相关）

**保留的依赖：**
- `tokio` - 异步运行时
- `mimalloc` - 内存分配器
- `uuid` - UUID支持
- `bytes` - 高效字节处理
- `anyhow` - 错误处理
- `tracing` / `tracing-subscriber` - 日志
- `serde` / `serde_json` - JSON序列化
- `sha1` - VLESS协议需要
- `socket2` - Socket配置
- `object-pool` - 缓冲区池

### 保留的核心功能

- **VLESS协议实现**：版本0和版本1完整支持
- **TCP代理转发**：异步双向数据转发
- **UDP over TCP**：UDP代理支持，30秒超时
- **用户UUID认证**：使用HashSet O(1)验证
- **配置向导**：首次运行交互式配置
- **性能优化**：缓冲区池、TCP_NODELAY、可配置缓冲区

## 文件变更清单

### 删除的文件
- `frontend/` - 整个前端项目
- `static/` - 前端构建产物
- `src/stats.rs` - 流量统计
- `src/ws.rs` - WebSocket
- `src/memory.rs` - 内存信息

### 修改的文件
- `src/main.rs` - 简化启动流程
- `src/config.rs` - 移除监控配置
- `src/server.rs` - 移除统计逻辑
- `src/http.rs` - 仅保留请求检测
- `src/utils.rs` - 移除IP检测
- `src/wizard.rs` - 移除IP和监控字段
- `Cargo.toml` - 移除不需要的依赖
- `README.md` - 更新文档
- `CLAUDE.md` - 更新项目文档

## 影响评估

### 正面影响
- **代码简化**：移除约3000行前端代码和相关后端逻辑
- **依赖减少**：移除5个外部依赖
- **体积减小**：编译后可执行文件从~3MB减少到~1MB（预估）
- **专注性**：项目定位更清晰，纯粹VLESS服务器
- **维护性**：减少了跨语言维护成本（Rust + JS/TS）

### 功能损失
- 无可视化监控界面
- 无流量统计和持久化
- 无实时连接数监控
- 无外网IP自动检测
- 无VLESS链接自动生成

## 兼容性说明

**配置文件兼容性：**
- 旧配置文件的 `monitor`、`monitoring` 字段会被忽略
- `public_ip` 字段会被忽略
- 建议删除旧配置文件中的这些字段

**使用场景变化：**
- 适用于不需要监控功能的纯代理场景
- 适用于配合其他监控方案（如 Prometheus + Grafana）的场景
- 不适用于需要可视化监控的用户

## 构建说明

```bash
# 编译项目
cargo build --release

# 运行
./target/release/vless.exe
```

可执行文件位于 `target/release/` 目录，单文件即可运行。
