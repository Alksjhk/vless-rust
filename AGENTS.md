# AGENTS.md

本文件定义项目开发中使用的 AI 助手（Agent）规则和行为规范。

## 项目角色定义

### 主开发者 (Primary Developer)
- 负责核心功能开发和架构设计
- 遵循代码规范和最佳实践
- 确保代码质量和安全性

### 审查者 (Reviewer)
- 负责代码审查和质量把关
- 检查安全性、性能、可维护性
- 提供改进建议

### 文档维护者 (Documentation Maintainer)
- 负责文档与代码同步
- 确保 API 文档、技术文档的准确性
- 维护更新日志

## 开发规范

### 代码提交规范

1. **提交前检查**:
   - 使用 `/code-review` 进行代码审查
   - 确保无 CRITICAL 和 HIGH 级别问题
   - MEDIUM 级别问题必须修复或说明原因

2. **提交信息格式**:
   ```
   <类型>: <简短描述>

   <详细说明（可选）>

   <关联 Issue（可选）>
   ```

   类型包括：
   - `feat`: 新功能
   - `fix`: 修复
   - `refactor`: 重构
   - `perf`: 性能优化
   - `docs`: 文档更新
   - `test`: 测试
   - `chore`: 构建/工具

3. **文档同步**:
   - 修改功能时同步更新 `docs/technology.md`
   - 修改 API 时同步更新 `docs/api.md`
   - 使用 `/docs` 技能进行文档更新

### 功能开发流程

1. **需求分析**:
   - 使用 `/brainstorm` 进行头脑风暴
   - 明确需求和技术方案
   - 添加到 `plan.md` 任务列表

2. **开发阶段**:
   - 按计划实施功能
   - 遵循模块化设计
   - 编写单元测试

3. **审查阶段**:
   - 使用 `/code-review` 审查代码
   - 修复发现的问题
   - 确保代码质量

4. **文档阶段**:
   - 更新技术文档
   - 更新 API 文档
   - 创建更新日志

5. **提交阶段**:
   - 使用 `/commit` 创建提交
   - 遵循提交信息格式

## 代码质量标准

### 安全性
- ✅ 无硬编码凭据（密码、密钥、Token）
- ✅ 输入验证完善
- ✅ 输出正确转义
- ✅ 认证和授权机制健全
- ✅ 敏感信息不记录到日志

### 性能
- ✅ 无不必要的内存分配
- ✅ 避免阻塞操作
- ✅ 合理使用缓存
- ✅ 批量操作优化

### 可维护性
- ✅ 函数单一职责
- ✅ 命名清晰明确
- ✅ 注释准确完整
- ✅ 模块化设计

### 测试
- ✅ 核心逻辑有单元测试
- ✅ 关键路径有集成测试
- ✅ 测试覆盖率不低于 60%

## 文档规范

### 必需文档

1. **CLAUDE.md**:
   - 项目概述
   - 常用命令
   - 架构设计
   - 开发指南

2. **README.md**:
   - 项目介绍
   - 快速开始
   - 配置说明
   - 部署指南

3. **docs/technology.md**:
   - 技术架构
   - 模块职责
   - 数据流
   - 性能优化

4. **docs/api.md**:
   - API 端点
   - 请求/响应格式
   - 错误码
   - 使用示例

### 可选文档

5. **docs/code-review.md**:
   - 代码审查报告
   - 问题列表
   - 改进建议

6. **docs/更新日志.md**:
   - 格式: `YYYY.MM.DD-更新主题.md`
   - 记录每次提交的功能变更

### 文档更新时机

- **必须更新**: 新增/修改/删除功能时
- **可选更新**: 优化、重构、修复 bug
- **不更新**: 语法错误、类型错误等细节修改

## 技术栈约束

### 后端 (Rust)
- Edition: 2021
- 异步运行时: Tokio
- 错误处理: anyhow
- 日志: tracing
- 序列化: serde

### 前端 (Vue 3)
- 框架: Vue 3 (Composition API)
- 构建工具: Vite (rolldown-vite)
- 状态管理: Composables
- 样式: CSS 变量

### 禁止事项
- ❌ 修改技术栈（未经明确同意）
- ❌ 使用硬编码绝对路径
- ❌ 添加不必要的依赖
- ❌ 破坏向后兼容性

## 项目结构规范

```
project/
├─ CLAUDE.md              # 项目指南
├─ AGENTS.md              # Agent 规则（本文件）
├─ plan.md                # 开发计划
├─ README.md              # 项目说明
├─ Cargo.toml             # Rust 配置
├─ config.json            # 服务器配置
├─ .cargo/
│  └─ config.toml         # 编译配置
├─ src/                   # Rust 源码
│  ├─ main.rs             # 程序入口
│  ├─ config.rs           # 配置模块
│  ├─ protocol.rs         # 协议处理
│  ├─ server.rs           # 服务器逻辑
│  ├─ stats.rs            # 统计模块
│  ├─ http.rs             # HTTP 处理
│  ├─ ws.rs               # WebSocket
│  ├─ tls.rs              # TLS 配置和证书
│  ├─ wizard.rs           # 初始化向导
│  ├─ memory.rs           # 内存池管理
│  └─ connection_pool.rs  # 连接池管理
├─ frontend/              # 前端项目
│  ├─ package.json        # NPM 配置
│  ├─ vite.config.js      # Vite 配置
│  └─ src/
│     ├─ main.js          # 入口
│     ├─ App.vue          # 根组件
│     ├─ components/      # 组件
│     └─ composables/     # Composables
├─ static/                # 前端构建产物
├─ certs/                 # TLS 证书目录
│  ├─ server.crt          # 服务器证书
│  └─ server.key          # 私钥文件
├─ docs/                  # 文档目录
│  ├─ technology.md       # 技术文档
│  ├─ api.md              # API 文档
│  └─ *.md                # 更新日志
└─ target/                # 编译输出
```

## 沟通协议

### 与用户交互

1. **明确需求**:
   - 不确定时使用 `AskUserQuestion` 工具
   - 提供选项供用户选择
   - 不擅自做出重大决策

2. **进度汇报**:
   - 使用 Task 工具跟踪进度
   - 完成任务后及时更新状态
   - 遇到阻塞及时报告

3. **问题处理**:
   - 严重问题立即报告
   - 提供解决方案
   - 不隐瞒问题

### AI Agent 间协作

1. **code-review Agent**:
   - 审查所有代码变更
   - 生成审查报告
   - 阻止有安全问题的代码

2. **docs Agent**:
   - 确保文档与代码同步
   - 生成 API 文档
   - 维护更新日志

3. **brainstorm Agent**:
   - 功能设计前的头脑风暴
   - 技术方案讨论
   - 风险评估

## 质量保证

### 自动化检查

1. **编译检查**:
   ```bash
   cargo check
   ```

2. **格式检查**:
   ```bash
   cargo fmt --check
   ```

3. **Linter 检查**:
   ```bash
   cargo clippy
   ```

4. **测试**:
   ```bash
   cargo test
   ```

### 手动检查

1. **代码审查**: 使用 `/code-review`
2. **文档审查**: 检查文档完整性
3. **功能测试**: 手动验证关键功能

## 应急处理

### 发现安全漏洞

1. 立即停止开发
2. 评估影响范围
3. 修复漏洞
4. 审查代码
5. 更新文档

### 性能问题

1. 使用 profiling 工具定位
2. 分析瓶颈
3. 优化关键路径
4. 验证改进效果

### 兼容性问题

1. 识别破坏性变更
2. 提供迁移指南
3. 保持向后兼容
4. 更新文档

## 持续改进

### 定期审查

- 每月审查依赖更新
- 每季度审查架构设计
- 每半年审查技术栈

### 反馈循环

- 收集用户反馈
- 分析使用数据
- 优化用户体验
- 改进文档


